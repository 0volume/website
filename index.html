<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Post-it Board</title>
    <style>
        * { -webkit-tap-highlight-color: none; }
        body { margin: 0; background: #7a4a1e; overflow: hidden; font-family: sans-serif; }
        #board { width: 100vw; height: 100vh; position: relative; }
        
        .note {
            position: absolute;
            width: 110px; height: 110px;
            padding: 8px;
            font-size: 10px;
            box-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            display: table;
            word-break: break-word;
            border-radius: 2px;
        }
        .note > span { display: table-cell; vertical-align: middle; text-align: center; }
        
        .yellow { background: #fef3bd; }
        .pink { background: #ffd1dc; }
        .blue { background: #cce5ff; }
        .green { background: #d4edda; }
        .lavender { background: #e6e6fa; }
        .peach { background: #ffe5d9; }
        
        .note .del { display: none; position: absolute; top: 2px; right: 2px; width: 16px; height: 16px; background: #e74c3c; color: white; border: none; border-radius: 50%; font-size: 10px; line-height: 16px; text-align: center; cursor: pointer; }
        .note.admindel .del { display: block; }
        
        #add { position: fixed; bottom: 12px; right: 12px; width: 50px; height: 50px; background: #27ae60; border-radius: 50%; border: none; color: white; font-size: 24px; box-shadow: 2px 2px 6px rgba(0,0,0,0.3); z-index: 50; }
        #admin { position: fixed; bottom: 12px; left: 12px; width: 50px; height: 50px; background: #9b59b6; border-radius: 50%; border: none; color: white; font-size: 11px; font-weight: bold; box-shadow: 2px 2px 6px rgba(0,0,0,0.3); z-index: 50; }
        
        .modal { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8); z-index: 100; align-items: center; justify-content: center; }
        .modal.on { display: flex; }
        
        .modalbox { background: white; padding: 14px; border-radius: 10px; width: 80%; max-width: 240px; }
        .modalbox h2 { margin: 0 0 10px; text-align: center; font-size: 16px; }
        
        textarea { width: 100%; height: 60px; font-size: 14px; padding: 6px; border: 2px solid #ddd; border-radius: 5px; resize: none; box-sizing: border-box; }
        textarea:focus { border-color: #3498db; outline: none; }
        
        .kb { display: flex; flex-wrap: wrap; gap: 3px; margin-top: 8px; justify-content: center; }
        .kb button { width: 26px; height: 28px; background: #eee; border: none; border-radius: 3px; font-size: 11px; cursor: pointer; }
        .kb button:active { background: #ccc; }
        .kb .w1 { width: 80px; }
        .kb .grn { background: #27ae60; color: white; }
        
        .btns { display: flex; gap: 6px; margin-top: 8px; }
        .btns button { flex: 1; padding: 8px; border: none; border-radius: 5px; font-size: 13px; cursor: pointer; }
        .btns .gray { background: #ddd; }
        .btns .green { background: #27ae60; color: white; }
        .btns .purple { background: #9b59b6; color: white; }
        
        input[type="text"], input[type="password"] { width: 100%; padding: 8px; font-size: 14px; border: 2px solid #ddd; border-radius: 5px; box-sizing: border-box; margin-bottom: 6px; }
        
        #toast { position: fixed; bottom: 80px; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.8); color: white; padding: 8px 16px; border-radius: 15px; font-size: 13px; display: none; z-index: 200; }
        #toast.on { display: block; }
    </style>
</head>
<body>
    <div id="board"></div>
    <button id="add">+</button>
    <button id="admin">ADMIN</button>
    
    <!-- Note Modal -->
    <div id="noteModal" class="modal">
        <div class="modalbox">
            <h2>New Note</h2>
            <textarea id="noteText" maxlength="150" placeholder="Type..."></textarea>
            <div class="kb">
                <button>Q</button><button>W</button><button>E</button><button>R</button><button>T</button><button>Y</button><button>U</button><button>I</button><button>O</button><button>P</button>
                <button>A</button><button>S</button><button>D</button><button>F</button><button>G</button><button>H</button><button>J</button><button>K</button><button>L</button>
                <button>Z</button><button>X</button><button>C</button><button>V</button><button>B</button><button>N</button><button>M</button>
                <button class="w1">⌫</button><button class="w1 grn">SAVE</button>
            </div>
            <div class="btns">
                <button class="gray" id="noteCancel">Cancel</button>
            </div>
        </div>
    </div>
    
    <!-- PIN Modal -->
    <div id="pinModal" class="modal">
        <div class="modalbox">
            <h2>Admin PIN</h2>
            <input type="password" id="pinText" maxlength="4" placeholder="4 digits" style="text-align:center;letter-spacing:8px;font-size:20px">
            <div class="btns">
                <button class="gray" id="pinCancel">Cancel</button>
                <button class="purple" id="pinOk">OK</button>
            </div>
        </div>
    </div>
    
    <div id="toast"></div>

    <script>
    (function() {
        var COLORS = ['yellow','pink','blue','green','lavender','peach'];
        var PIN = '1234';
        var notes = [];
        var adminMode = false;
        
        // Grid system - no overlap
        var gridW, gridH, cellW, cellH;
        var usedCells = {};
        
        function initGrid() {
            gridW = 3;
            gridH = 5;
            cellW = window.innerWidth / gridW;
            cellH = (window.innerHeight - 100) / gridH;
            usedCells = {};
        }
        
        function getPos() {
            var cells = [];
            for (var r = 0; r < gridH; r++) {
                for (var c = 0; c < gridW; c++) {
                    if (!usedCells[r + ',' + c]) cells.push({r:r, c:c});
                }
            }
            if (cells.length === 0) {
                return {x: 20 + Math.random() * (window.innerWidth - 130), y: 60 + Math.random() * (window.innerHeight - 200)};
            }
            var cell = cells[Math.floor(Math.random() * cells.length)];
            usedCells[cell.r + ',' + cell.c] = true;
            return {
                x: cell.c * cellW + 8 + Math.random() * 15,
                y: cell.r * cellH + 50 + Math.random() * 15
            };
        }
        
        function load() {
            initGrid();
            var s = localStorage.getItem('pnotes');
            if (s) { try { notes = JSON.parse(s); } catch(e) { notes = []; } }
            
            notes.forEach(function(n) {
                var c = Math.floor(n.x / cellW);
                var r = Math.floor((n.y - 50) / cellH);
                if (r >= 0 && r < gridH && c >= 0 && c < gridW) usedCells[r + ',' + c] = true;
            });
            
            if (notes.length === 0) {
                notes = [
                    {id:1, t:'Tap + for new', c:'yellow', x:10, y:55},
                    {id:2, t:'Tap ADMIN for del', c:'pink', x:120, y:60}
                ];
                usedCells['0,0'] = true;
                usedCells['1,0'] = true;
            }
            render();
        }
        
        function save() {
            localStorage.setItem('pnotes', JSON.stringify(notes));
        }
        
        function render() {
            var b = document.getElementById('board');
            b.innerHTML = '';
            notes.forEach(function(n) {
                var el = document.createElement('div');
                el.className = 'note ' + n.c;
                if (adminMode) el.className += ' admindel';
                el.style.left = n.x + 'px';
                el.style.top = n.y + 'px';
                el.innerHTML = '<span>' + n.t + '</span><button class="del" data-id="'+n.id+'">×</button>';
                if (adminMode) {
                    el.querySelector('.del').onclick = function(e) {
                        e.stopPropagation();
                        delNote(n.id);
                    };
                }
                b.appendChild(el);
            });
        }
        
        function delNote(id) {
            notes = notes.filter(function(n) { return n.id !== id; });
            save();
            render();
            toast('Deleted');
            syncWeb();
        }
        
        function toast(msg) {
            var t = document.getElementById('toast');
            t.textContent = msg;
            t.className = 'on';
            setTimeout(function() { t.className = ''; }, 2000);
        }
        
        // Buttons
        document.getElementById('add').onclick = function() {
            document.getElementById('noteModal').className = 'modal on';
            document.getElementById('noteText').value = '';
            setTimeout(function() { document.getElementById('noteText').focus(); }, 50);
        };
        
        document.getElementById('admin').onclick = function() {
            document.getElementById('pinModal').className = 'modal on';
            document.getElementById('pinText').value = '';
            setTimeout(function() { document.getElementById('pinText').focus(); }, 50);
        };
        
        // Cancel buttons
        document.getElementById('noteCancel').onclick = function() {
            document.getElementById('noteModal').className = 'modal';
        };
        
        document.getElementById('pinCancel').onclick = function() {
            document.getElementById('pinModal').className = 'modal';
        };
        
        // Keyboard
        var kb = document.querySelectorAll('.kb button');
        for (var i = 0; i < kb.length; i++) {
            kb[i].onclick = (function(b) {
                return function(e) {
                    e.preventDefault();
                    var txt = b.textContent;
                    var input = document.getElementById('noteText');
                    if (txt === '⌫') input.value = input.value.slice(0,-1);
                    else if (txt === 'SAVE') doSave();
                    else input.value += txt.toLowerCase();
                };
            })(kb[i]);
        }
        
        // Save
        function doSave() {
            var txt = document.getElementById('noteText').value.trim();
            if (!txt) { toast('Type something!'); return; }
            
            var pos = getPos();
            notes.push({
                id: Date.now(),
                t: txt,
                c: COLORS[Math.floor(Math.random() * COLORS.length)],
                x: pos.x,
                y: pos.y
            });
            
            save();
            document.getElementById('noteModal').className = 'modal';
            render();
            toast('Saved!');
            syncWeb();
        }
        
        // PIN check
        document.getElementById('pinOk').onclick = function() {
            checkPin();
        };
        
        document.getElementById('pinText').oninput = function() {
            if (this.value.length === 4) checkPin();
        };
        
        function checkPin() {
            var pin = document.getElementById('pinText').value;
            if (pin === PIN) {
                adminMode = !adminMode;
                document.getElementById('pinModal').className = 'modal';
                render();
                toast(adminMode ? 'Admin ON - tap ×' : 'Admin OFF');
            } else if (pin.length === 4) {
                toast('Wrong PIN');
                document.getElementById('pinText').value = '';
            }
        }
        
        // Web sync
        function syncWeb() {
            var tok = localStorage.getItem('ptok');
            var gist = localStorage.getItem('pgist');
            if (!tok) return;
            
            var content = JSON.stringify({notes:notes, v:1});
            
            if (gist) {
                fetch('https://api.github.com/gists/' + gist, {
                    method: 'PATCH',
                    headers: {'Authorization':'token '+tok, 'Content-Type':'application/json'},
                    body: JSON.stringify({files:{'notes.json':{content:content}}})
                }).catch(function(){});
            } else {
                fetch('https://api.github.com/gists', {
                    method: 'POST',
                    headers: {'Authorization':'token '+tok, 'Content-Type':'application/json'},
                    body: JSON.stringify({description:'Post-it Notes', public:false, files:{'notes.json':{content:content}}})
                }).then(function(r){return r.json();}).then(function(d){
                    localStorage.setItem('pgist', d.id);
                }).catch(function(){});
            }
        }
        
        // Init
        load();
    })();
    </script>
</body>
</html>
