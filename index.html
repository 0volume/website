<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Post-it Board</title>
    <style>
        * { -webkit-tap-highlight-color: none; }
        body { margin: 0; background: #7a4a1e; overflow: hidden; font-family: sans-serif; transition: background 0.3s; }
        #board { width: 100vw; height: 100vh; position: relative; }
        
        .note { position: absolute; padding: 8px; box-shadow: 2px 2px 4px rgba(0,0,0,0.3); display: table; word-break: break-word; border-radius: 2px; transition: all 0.3s; }
        .note > span { display: table-cell; vertical-align: middle; text-align: center; }
        
        .note.yellow { background: #fef3bd; }
        .note.pink { background: #ffd1dc; }
        .note.blue { background: #cce5ff; }
        .note.green { background: #d4edda; }
        .note.lavender { background: #e6e6fa; }
        .note.peach { background: #ffe5d9; }
        
        body.dark .note.yellow { background: #8B8B4B; color: #fff; }
        body.dark .note.pink { background: #8B4B5B; color: #fff; }
        body.dark .note.blue { background: #4B5B8B; color: #fff; }
        body.dark .note.green { background: #4B8B5B; color: #fff; }
        body.dark .note.lavender { background: #5B5B8B; color: #fff; }
        body.dark .note.peach { background: #8B6B4B; color: #fff; }
        
        body.pastel .note { opacity: 0.85; }
        body.bright .note { box-shadow: 4px 4px 8px rgba(0,0,0,0.5); }
        
        .note .del { display: none; position: absolute; top: 2px; right: 2px; width: 16px; height: 16px; background: #e74c3c; color: white; border: none; border-radius: 50%; font-size: 10px; line-height: 16px; text-align: center; cursor: pointer; }
        .note.admindel .del { display: block; }
        
        #add { position: fixed; bottom: 12px; right: 12px; width: 50px; height: 50px; background: #27ae60; border-radius: 50%; border: none; color: white; font-size: 24px; box-shadow: 2px 2px 6px rgba(0,0,0,0.3); z-index: 50; }
        
        #adminBar { display: none; position: fixed; bottom: 12px; left: 12px; right: 80px; height: 50px; background: #9b59b6; border-radius: 25px; box-shadow: 2px 2px 6px rgba(0,0,0,0.3); z-index: 50; align-items: center; justify-content: space-around; padding: 0 10px; }
        #adminBar.show { display: flex; }
        
        #adminBar button { background: none; border: none; color: white; font-size: 11px; font-weight: bold; padding: 8px 12px; cursor: pointer; }
        
        .modal { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8); z-index: 100; align-items: center; justify-content: center; }
        .modal.on { display: flex; }
        
        .modalbox { background: white; padding: 14px; border-radius: 10px; width: 80%; max-width: 280px; max-height: 80vh; overflow-y: auto; }
        .modalbox h2 { margin: 0 0 10px; text-align: center; font-size: 16px; }
        
        textarea { width: 100%; height: 60px; font-size: 14px; padding: 6px; border: 2px solid #ddd; border-radius: 5px; resize: none; box-sizing: border-box; }
        textarea:focus { border-color: #3498db; outline: none; }
        
        .kb { display: flex; flex-wrap: wrap; gap: 3px; margin-top: 8px; justify-content: center; }
        .kb button { width: 26px; height: 28px; background: #eee; border: none; border-radius: 3px; font-size: 11px; cursor: pointer; }
        .kb button:active { background: #ccc; }
        .kb .w1 { width: 80px; }
        .kb .grn { background: #27ae60; color: white; }
        
        .btns { display: flex; gap: 6px; margin-top: 8px; }
        .btns button { flex: 1; padding: 8px; border: none; border-radius: 5px; font-size: 13px; cursor: pointer; }
        .btns .gray { background: #ddd; }
        .btns .green { background: #27ae60; color: white; }
        .btns .purple { background: #9b59b6; color: white; }
        .btns .red { background: #e74c3c; color: white; }
        
        select { width: 100%; padding: 8px; font-size: 14px; border: 2px solid #ddd; border-radius: 5px; margin-bottom: 8px; box-sizing: border-box; }
        
        .row { margin-bottom: 10px; }
        .row label { display: block; font-size: 12px; color: #666; margin-bottom: 4px; }
        
        #toast { position: fixed; bottom: 80px; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.8); color: white; padding: 8px 16px; border-radius: 15px; font-size: 13px; display: none; z-index: 200; }
        #toast.on { display: block; }
    </style>
</head>
<body>
    <div id="board"></div>
    <button id="add">+</button>
    
    <div id="adminBar">
        <button id="btnSettings">⚙️ SETTINGS</button>
        <button id="btnExitAdmin">❌ EXIT ADMIN</button>
    </div>
    
    <!-- Note Modal -->
    <div id="noteModal" class="modal">
        <div class="modalbox">
            <h2>New Note</h2>
            <textarea id="noteText" maxlength="150" placeholder="Type..."></textarea>
            <div class="kb">
                <button>Q</button><button>W</button><button>E</button><button>R</button><button>T</button><button>Y</button><button>U</button><button>I</button><button>O</button><button>P</button>
                <button>A</button><button>S</button><button>D</button><button>F</button><button>G</button><button>H</button><button>J</button><button>K</button><button>L</button>
                <button>Z</button><button>X</button><button>C</button><button>V</button><button>B</button><button>N</button><button>M</button>
                <button class="w1">⌫</button><button class="w1 grn">SAVE</button>
            </div>
            <div class="btns">
                <button class="gray" id="noteCancel">Cancel</button>
            </div>
        </div>
    </div>
    
    <!-- PIN Modal -->
    <div id="pinModal" class="modal">
        <div class="modalbox">
            <h2>Admin PIN</h2>
            <input type="password" id="pinText" maxlength="4" placeholder="4 digits" style="width:100%;padding:10px;font-size:20px;text-align:center;letter-spacing:8px;box-sizing:border-box;margin-bottom:8px">
            <div class="btns">
                <button class="gray" id="pinCancel">Cancel</button>
                <button class="purple" id="pinOk">OK</button>
            </div>
        </div>
    </div>
    
    <!-- Settings Modal -->
    <div id="setModal" class="modal">
        <div class="modalbox">
            <h2>⚙️ Settings</h2>
            
            <div class="row">
                <label>Note Size</label>
                <select id="setSize">
                    <option value="small">Small</option>
                    <option value="medium" selected>Medium</option>
                    <option value="large">Large</option>
                    <option value="xlarge">Extra Large</option>
                </select>
            </div>
            
            <div class="row">
                <label>Color Scheme</label>
                <select id="setScheme">
                    <option value="default" selected>Default</option>
                    <option value="dark">Dark</option>
                    <option value="pastel">Pastel</option>
                    <option value="bright">Bright</option>
                </select>
            </div>
            
            <div class="row">
                <label>Background</label>
                <select id="setBg">
                    <option value="#7a4a1e" selected>Wood Brown</option>
                    <option value="#2c3e50">Dark Blue</option>
                    <option value="#34495e">Slate</option>
                    <option value="#1a1a2e">Midnight</option>
                    <option value="#2d3436">Charcoal</option>
                    <option value="#636e72">Gray</option>
                    <option value="#000000">Black</option>
                </select>
            </div>
            
            <div class="row">
                <label>Font</label>
                <select id="setFont">
                    <option value="sans-serif" selected>Sans Serif</option>
                    <option value="serif">Serif</option>
                    <option value="monospace">Monospace</option>
                    <option value="cursive">Cursive</option>
                </select>
            </div>
            
            <div class="row">
                <label>GitHub Token</label>
                <input type="password" id="setToken" placeholder="ghp_xxx...">
            </div>
            
            <div class="row">
                <label>Gist ID</label>
                <input type="text" id="setGist" placeholder="Optional">
            </div>
            
            <div class="btns">
                <button class="gray" id="setCancel">Cancel</button>
                <button class="green" id="setSave">Save</button>
            </div>
        </div>
    </div>
    
    <div id="toast"></div>

    <script>
    (function() {
        var COLORS = ['yellow','pink','blue','green','lavender','peach'];
        var PIN = '1234';
        var notes = [];
        var adminMode = false;
        
        var settings = { size: 'medium', scheme: 'default', bg: '#7a4a1e', font: 'sans-serif' };
        var SIZE_MAP = { small: 80, medium: 110, large: 140, xlarge: 180 };
        
        var gridW = 3, gridH = 5, cellW, cellH, usedCells = {};
        
        function initGrid() {
            cellW = window.innerWidth / gridW;
            cellH = (window.innerHeight - 100) / gridH;
            usedCells = {};
        }
        
        function getPos() {
            var cells = [];
            for (var r = 0; r < gridH; r++) {
                for (var c = 0; c < gridW; c++) {
                    if (!usedCells[r + ',' + c]) cells.push({r:r, c:c});
                }
            }
            if (cells.length === 0) {
                return {x: 20 + Math.random() * (window.innerWidth - 150), y: 60 + Math.random() * (window.innerHeight - 200)};
            }
            var cell = cells[Math.floor(Math.random() * cells.length)];
            usedCells[cell.r + ',' + cell.c] = true;
            return {
                x: cell.c * cellW + 8 + Math.random() * 15,
                y: cell.r * cellH + 50 + Math.random() * 15
            };
        }
        
        function load() {
            initGrid();
            
            try { var sset = localStorage.getItem('pset'); if (sset) settings = JSON.parse(sset); } catch(e) {}
            applySettings();
            
            try { var s = localStorage.getItem('pnotes'); if (s) notes = JSON.parse(s); } catch(e) { notes = []; }
            
            notes.forEach(function(n) {
                var c = Math.floor(n.x / cellW);
                var r = Math.floor((n.y - 50) / cellH);
                if (r >= 0 && r < gridH && c >= 0 && c < gridW) usedCells[r + ',' + c] = true;
            });
            
            if (notes.length === 0) {
                notes = [
                    {id:1, t:'Tap + for new', c:'yellow', x:10, y:55},
                    {id:2, t:'ADMIN for settings', c:'pink', x:120, y:60}
                ];
                usedCells['0,0'] = true;
                usedCells['1,0'] = true;
            }
            render();
            loadFromWeb();
        }
        
        function applySettings() {
            document.body.style.background = settings.bg;
            document.body.style.fontFamily = settings.font;
            document.body.className = '';
            if (settings.scheme !== 'default') document.body.className = settings.scheme;
        }
        
        function saveSettings() { try { localStorage.setItem('pset', JSON.stringify(settings)); } catch(e) {} }
        function save() { try { localStorage.setItem('pnotes', JSON.stringify(notes)); } catch(e) {} }
        
        function render() {
            var b = document.getElementById('board');
            b.innerHTML = '';
            var sz = SIZE_MAP[settings.size] || 110;
            
            notes.forEach(function(n) {
                var el = document.createElement('div');
                el.className = 'note ' + n.c;
                if (adminMode) el.className += ' admindel';
                el.style.left = n.x + 'px';
                el.style.top = n.y + 'px';
                el.style.width = sz + 'px';
                el.style.height = sz + 'px';
                el.style.fontSize = (sz / 10) + 'px';
                el.innerHTML = '<span>' + n.t + '</span><button class="del" data-id="'+n.id+'">×</button>';
                if (adminMode) {
                    el.querySelector('.del').onclick = function(e) {
                        e.stopPropagation();
                        delNote(n.id);
                    };
                }
                b.appendChild(el);
            });
            
            // Show/hide admin bar
            document.getElementById('adminBar').className = adminMode ? 'show' : '';
        }
        
        function delNote(id) {
            notes = notes.filter(function(n) { return n.id !== id; });
            save();
            render();
            toast('Deleted');
            syncWeb();
        }
        
        function toast(msg) {
            var t = document.getElementById('toast');
            t.textContent = msg;
            t.className = 'on';
            setTimeout(function() { t.className = ''; }, 2000);
        }
        
        // Add button
        document.getElementById('add').onclick = function() {
            document.getElementById('noteModal').className = 'modal on';
            document.getElementById('noteText').value = '';
            setTimeout(function() { document.getElementById('noteText').focus(); }, 50);
        };
        
        document.getElementById('noteCancel').onclick = function() {
            document.getElementById('noteModal').className = 'modal';
        };
        
        // Keyboard
        var kb = document.querySelectorAll('.kb button');
        for (var i = 0; i < kb.length; i++) {
            kb[i].onclick = (function(b) {
                return function(e) {
                    e.preventDefault();
                    var txt = b.textContent;
                    var input = document.getElementById('noteText');
                    if (txt === '⌫') input.value = input.value.slice(0,-1);
                    else if (txt === 'SAVE') doSave();
                    else input.value += txt.toLowerCase();
                };
            })(kb[i]);
        }
        
        function doSave() {
            var txt = document.getElementById('noteText').value.trim();
            if (!txt) { toast('Type something!'); return; }
            
            var pos = getPos();
            notes.push({
                id: Date.now(),
                t: txt,
                c: COLORS[Math.floor(Math.random() * COLORS.length)],
                x: pos.x,
                y: pos.y
            });
            
            save();
            document.getElementById('noteModal').className = 'modal';
            render();
            toast('Saved!');
            syncWeb();
        }
        
        // Admin button triggers PIN
        var adminBtn = document.createElement('button');
        adminBtn.id = 'admin';
        adminBtn.textContent = 'ADMIN';
        adminBtn.style.cssText = 'position:fixed;bottom:12px;left:12px;width:50px;height:50px;background:#9b59b6;border-radius:50%;border:none;color:white;font-size:11px;font-weight:bold;box-shadow:2px 2px 6px rgba(0,0,0,0.3);z-index:50;';
        document.body.appendChild(adminBtn);
        
        adminBtn.onclick = function() {
            document.getElementById('pinModal').className = 'modal on';
            document.getElementById('pinText').value = '';
            setTimeout(function() { document.getElementById('pinText').focus(); }, 50);
        };
        
        document.getElementById('pinCancel').onclick = function() {
            document.getElementById('pinModal').className = 'modal';
        };
        
        function checkPin() {
            var pin = document.getElementById('pinText').value;
            if (pin === PIN) {
                adminMode = true;
                document.getElementById('pinModal').className = 'modal';
                render();
                toast('Admin ON - Use the purple bar below!');
            } else if (pin.length === 4) {
                toast('Wrong PIN');
                document.getElementById('pinText').value = '';
            }
        }
        
        document.getElementById('pinOk').onclick = checkPin;
        document.getElementById('pinText').oninput = function() {
            if (this.value.length === 4) checkPin();
        };
        
        // Admin bar buttons
        document.getElementById('btnSettings').onclick = function() {
            showSettings();
        };
        
        document.getElementById('btnExitAdmin').onclick = function() {
            adminMode = false;
            render();
            toast('Admin OFF');
        };
        
        function showSettings() {
            document.getElementById('setSize').value = settings.size;
            document.getElementById('setScheme').value = settings.scheme;
            document.getElementById('setBg').value = settings.bg;
            document.getElementById('setFont').value = settings.font;
            document.getElementById('setToken').value = localStorage.getItem('ptok') || '';
            document.getElementById('setGist').value = localStorage.getItem('pgist') || '';
            document.getElementById('setModal').className = 'modal on';
        }
        
        document.getElementById('setCancel').onclick = function() {
            document.getElementById('setModal').className = 'modal';
        };
        
        document.getElementById('setSave').onclick = function() {
            settings.size = document.getElementById('setSize').value;
            settings.scheme = document.getElementById('setScheme').value;
            settings.bg = document.getElementById('setBg').value;
            settings.font = document.getElementById('setFont').value;
            
            var tok = document.getElementById('setToken').value.trim();
            var gist = document.getElementById('setGist').value.trim();
            
            if (tok) localStorage.setItem('ptok', tok);
            if (gist) localStorage.setItem('pgist', gist);
            
            saveSettings();
            applySettings();
            render();
            
            document.getElementById('setModal').className = 'modal';
            toast('Settings saved!');
            syncWeb();
        };
        
        // Web sync
        function syncWeb() {
            var tok = localStorage.getItem('ptok');
            var gist = localStorage.getItem('pgist');
            if (!tok) return;
            
            var content = JSON.stringify({ notes: notes, settings: settings, v: 2 });
            
            if (gist) {
                fetch('https://api.github.com/gists/' + gist, {
                    method: 'PATCH',
                    headers: {'Authorization':'token '+tok, 'Content-Type':'application/json'},
                    body: JSON.stringify({files:{'notes.json':{content:content}}})
                }).catch(function(){});
            } else {
                fetch('https://api.github.com/gists', {
                    method: 'POST',
                    headers: {'Authorization':'token '+tok, 'Content-Type':'application/json'},
                    body: JSON.stringify({description:'Post-it Notes', public:false, files:{'notes.json':{content:content}}})
                }).then(function(r){return r.json();}).then(function(d){
                    localStorage.setItem('pgist', d.id);
                }).catch(function(){});
            }
        }
        
        function loadFromWeb() {
            var tok = localStorage.getItem('ptok');
            var gist = localStorage.getItem('pgist');
            if (!tok || !gist) return;
            
            fetch('https://api.github.com/gists/' + gist, {
                headers: {'Authorization':'token '+tok}
            }).then(function(r){return r.json();}).then(function(d){
                if (d.files && d.files['notes.json']) {
                    try {
                        var data = JSON.parse(d.files['notes.json'].content);
                        if (data.settings) {
                            settings = data.settings;
                            saveSettings();
                            applySettings();
                        }
                        if (data.notes && data.notes.length) {
                            notes = data.notes;
                            save();
                        }
                    } catch(e) {}
                }
            }).catch(function(){}).then(function(){
                render();
            });
        }
        
        load();
    })();
    </script>
</body>
</html>
