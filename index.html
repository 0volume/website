<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Post-it Board</title>
    <style>
        * { -webkit-tap-highlight-color: transparent; -webkit-touch-callout: none; }
        body { margin: 0; background: #8B5A2B; font-family: -apple-system, sans-serif; overflow: hidden; }
        #board { width: 100vw; height: 100vh; position: relative; overflow: hidden; }
        .note { position: absolute; width: 130px; height: 130px; padding: 8px; font-size: 11px; box-shadow: 2px 2px 6px rgba(0,0,0,0.3); display: flex; align-items: center; justify-content: center; text-align: center; word-wrap: break-word; user-select: none; border-radius: 2px; }
        .yellow { background: #fef3bd; }
        .pink { background: #ffd1dc; }
        .blue { background: #cce5ff; }
        .green { background: #d4edda; }
        .lavender { background: #e6e6fa; }
        .peach { background: #ffe5d9; }
        #add { position: fixed; bottom: 20px; right: 20px; width: 56px; height: 56px; background: #3498db; border-radius: 50%; border: none; color: white; font-size: 28px; cursor: pointer; box-shadow: 2px 2px 8px rgba(0,0,0,0.3); z-index: 100; }
        #gear { position: fixed; bottom: 22px; left: 22px; width: 36px; height: 36px; background: rgba(255,255,255,0.25); border-radius: 50%; border: none; color: white; font-size: 16px; z-index: 100; }
        .modal { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.75); z-index: 200; align-items: center; justify-content: center; }
        .modal.open { display: flex; }
        .box { background: white; padding: 16px; border-radius: 12px; width: 85%; max-width: 280px; }
        .box h2 { margin: 0 0 12px; text-align: center; font-size: 18px; }
        textarea { width: 100%; height: 70px; font-size: 15px; padding: 8px; border: 2px solid #ddd; border-radius: 6px; resize: none; font-family: inherit; box-sizing: border-box; }
        textarea:focus { outline: none; border-color: #3498db; }
        .row { display: flex; gap: 8px; margin-top: 10px; }
        .row button { flex: 1; padding: 10px; border: none; border-radius: 6px; font-size: 14px; cursor: pointer; }
        .gray { background: #ddd; }
        .green { background: #27ae60; color: white; }
        .kb { display: grid; grid-template-columns: repeat(9, 1fr); gap: 4px; margin-top: 10px; }
        .kb button { padding: 10px 0; background: #eee; border: none; border-radius: 4px; font-size: 14px; cursor: pointer; }
        .kb button:active { background: #ccc; }
        .kb .sp { grid-column: span 5; }
        .kb .sv { background: #3498db; color: white; }
        .kb .bs { background: #e74c3c; color: white; }
        input { width: 100%; padding: 10px; font-size: 16px; border: 2px solid #ddd; border-radius: 6px; box-sizing: border-box; margin-bottom: 8px; }
        #msg { position: fixed; bottom: 90px; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.8); color: white; padding: 10px 20px; border-radius: 20px; font-size: 14px; display: none; z-index: 300; }
        #msg.show { display: block; }
        .del { position: absolute; top: 2px; right: 2px; width: 18px; height: 18px; background: #e74c3c; color: white; border: none; border-radius: 50%; font-size: 12px; display: none; }
        .showdel .del { display: block; }
    </style>
</head>
<body>
    <div id="board"></div>
    <button id="add">+</button>
    <button id="gear">⚙</button>
    
    <div id="modal" class="modal">
        <div class="box">
            <h2>New Note</h2>
            <textarea id="input" placeholder="Type here..." maxlength="200"></textarea>
            <div class="kb">
                <button>Q</button><button>W</button><button>E</button><button>R</button><button>T</button><button>Y</button><button>U</button><button>I</button><button>O</button>
                <button>P</button><button>A</button><button>S</button><button>D</button><button>F</button><button>G</button><button>H</button><button>J</button><button>K</button>
                <button>L</button><button>Z</button><button>X</button><button>C</button><button>V</button><button>B</button><button>N</button><button>M</button>
                <button class="bs">⌫</button><button class="sp">space</button><button class="sv">✓</button>
            </div>
            <div class="row">
                <button class="gray" id="close">Cancel</button>
                <button class="green" id="save">Save</button>
            </div>
        </div>
    </div>
    
    <div id="pinmodal" class="modal">
        <div class="box">
            <h2>Admin PIN</h2>
            <input type="password" id="pin" maxlength="4" style="text-align:center;letter-spacing:8px;font-size:24px" placeholder="••••">
            <div class="row">
                <button class="gray" id="pincancel">Cancel</button>
            </div>
        </div>
    </div>
    
    <div id="setmodal" class="modal">
        <div class="box">
            <h2>Settings</h2>
            <input type="password" id="token" placeholder="GitHub Token">
            <input type="text" id="gist" placeholder="Gist ID">
            <div class="row">
                <button class="gray" id="setcancel">Cancel</button>
                <button class="green" id="setsave">Save</button>
            </div>
        </div>
    </div>
    
    <div id="msg"></div>

    <script>
    (function() {
        const COLORS = ['yellow','pink','blue','green','lavender','peach'];
        const PIN = '1234';
        
        let notes = [];
        let admin = false;
        let lastTap = 0;
        
        // Load
        let saved = localStorage.getItem('pnotes');
        if (saved) {
            try { notes = JSON.parse(saved); } catch(e) {}
        }
        if (!notes.length) {
            notes = [
                {id:1, text:'Welcome! Tap +', color:'yellow', x:20, y:50},
                {id:2, text:'Double-tap + for admin', color:'pink', x:160, y:70}
            ];
        }
        
        // Elements
        const board = document.getElementById('board');
        const addBtn = document.getElementById('add');
        const gearBtn = document.getElementById('gear');
        const modal = document.getElementById('modal');
        const pinmodal = document.getElementById('pinmodal');
        const setmodal = document.getElementById('setmodal');
        const input = document.getElementById('input');
        const msg = document.getElementById('msg');
        
        function render() {
            board.innerHTML = '';
            notes.forEach(function(n) {
                const div = document.createElement('div');
                div.className = 'note ' + n.color;
                if (admin) div.className += ' showdel';
                div.style.left = n.x + 'px';
                div.style.top = n.y + 'px';
                div.innerHTML = '<button class="del" data-id="'+n.id+'">×</button><span>'+n.text+'</span>';
                
                if (admin) {
                    div.querySelector('.del').onclick = function(e) {
                        e.stopPropagation();
                        notes = notes.filter(function(x) { return x.id !== n.id; });
                        save();
                        render();
                        show('Deleted');
                    };
                }
                
                board.appendChild(div);
            });
        }
        
        function save() {
            localStorage.setItem('pnotes', JSON.stringify(notes));
        }
        
        function show(t) {
            msg.textContent = t;
            msg.className = 'show';
            setTimeout(function() { msg.className = ''; }, 2000);
        }
        
        function randX() { return 10 + Math.random() * (window.innerWidth - 150); }
        function randY() { return 50 + Math.random() * (window.innerHeight - 200); }
        
        // Add button
        addBtn.onclick = function() {
            modal.className = 'modal open';
            input.value = '';
            setTimeout(function() { input.focus(); }, 50);
        };
        
        document.getElementById('close').onclick = function() {
            modal.className = 'modal';
        };
        
        // Keyboard
        var keys = document.querySelectorAll('.kb button');
        for (var i = 0; i < keys.length; i++) {
            keys[i].onclick = (function(btn) {
                return function(e) {
                    e.preventDefault();
                    var txt = btn.textContent;
                    if (txt === '⌫') {
                        input.value = input.value.slice(0, -1);
                    } else if (txt === '✓') {
                        document.getElementById('save').onclick();
                    } else if (txt === 'space') {
                        input.value += ' ';
                    } else {
                        input.value += txt.toLowerCase();
                    }
                };
            })(keys[i]);
        }
        
        // Save
        document.getElementById('save').onclick = function() {
            var txt = input.value.trim();
            if (!txt) { show('Type something!'); return; }
            
            notes.push({
                id: Date.now(),
                text: txt,
                color: COLORS[Math.floor(Math.random() * COLORS.length)],
                x: randX(),
                y: randY()
            });
            
            save();
            
            // Sync to web if token
            syncWeb();
            
            modal.className = 'modal';
            render();
            show('Saved!');
        };
        
        // Double tap for admin
        addBtn.ontouchend = function(e) {
            e.preventDefault();
            var now = Date.now();
            if (now - lastTap < 350) {
                pinmodal.className = 'modal open';
                document.getElementById('pin').value = '';
                document.getElementById('pin').focus();
            }
            lastTap = now;
        };
        
        // PIN
        document.getElementById('pin').oninput = function() {
            if (this.value.length === 4) {
                if (this.value === PIN) {
                    admin = !admin;
                    render();
                    show(admin ? 'Admin ON' : 'Admin OFF');
                    pinmodal.className = 'modal';
                } else {
                    show('Wrong PIN');
                    this.value = '';
                }
            }
        };
        
        document.getElementById('pincancel').onclick = function() {
            pinmodal.className = 'modal';
        };
        
        // Settings (long press gear)
        var gearTimer;
        gearBtn.ontouchstart = function() {
            gearTimer = setTimeout(openSet, 1000);
        };
        gearBtn.ontouchend = function() {
            clearTimeout(gearTimer);
        };
        gearBtn.onmousedown = function() {
            gearTimer = setTimeout(openSet, 1000);
        };
        gearBtn.onmouseup = function() {
            clearTimeout(gearTimer);
        };
        
        function openSet() {
            document.getElementById('token').value = localStorage.getItem('ptok') || '';
            document.getElementById('gist').value = localStorage.getItem('pgist') || '';
            setmodal.className = 'modal open';
        }
        
        document.getElementById('setcancel').onclick = function() {
            setmodal.className = 'modal';
        };
        
        document.getElementById('setsave').onclick = function() {
            localStorage.setItem('ptok', document.getElementById('token').value);
            localStorage.setItem('pgist', document.getElementById('gist').value);
            setmodal.className = 'modal';
            show('Saved!');
            syncWeb();
        };
        
        // Web sync
        function syncWeb() {
            var token = localStorage.getItem('ptok');
            var gist = localStorage.getItem('pgist');
            if (!token) return;
            
            var content = JSON.stringify({notes: notes, version: 1});
            
            if (gist) {
                fetch('https://api.github.com/gists/' + gist, {
                    method: 'PATCH',
                    headers: {
                        'Authorization': 'token ' + token,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        files: { 'notes.json': { content: content } }
                    })
                }).catch(function() {});
            } else {
                fetch('https://api.github.com/gists', {
                    method: 'POST',
                    headers: {
                        'Authorization': 'token ' + token,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        description: 'Post-it Notes',
                        public: false,
                        files: { 'notes.json': { content: content } }
                    })
                }).then(function(r) { return r.json(); }).then(function(d) {
                    localStorage.setItem('pgist', d.id);
                }).catch(function() {});
            }
        }
        
        // Load from web on init
        var token = localStorage.getItem('ptok');
        var gist = localStorage.getItem('pgist');
        if (token && gist) {
            fetch('https://api.github.com/gists/' + gist, {
                headers: { 'Authorization': 'token ' + token }
            }).then(function(r) { return r.json(); }).then(function(d) {
                if (d.files && d.files['notes.json']) {
                    try {
                        var loaded = JSON.parse(d.files['notes.json'].content).notes;
                        if (loaded && loaded.length) {
                            notes = loaded;
                            save();
                        }
                    } catch(e) {}
                }
            }).catch(function() {}).then(function() {
                render();
            });
        } else {
            render();
        }
    })();
    </script>
</body>
</html>
